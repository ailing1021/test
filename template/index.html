<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ’° è¶…ç´šé‚„æ¬¾è©¦ç®—è¡¨ - 700è¡Œå®Œæ•´ç‰ˆ</title>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.20.12/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  /* --- åŸºæœ¬æ’ç‰ˆèˆ‡æ¨£å¼ --- */
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f9fafb;
    color: #111827;
  }
  #root {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  main {
    flex-grow: 1;
    max-width: 1280px;
    margin: 20px auto 0 auto;
    padding: 20px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  }
  h1, h2, h3 {
    margin: 0 0 12px 0;
    font-weight: 700;
  }
  h1 {
    font-size: 2.5rem;
    color: #1e293b;
    text-align: center;
  }
  h2 {
    font-size: 1.7rem;
    color: #334155;
    border-bottom: 2px solid #3b82f6;
    padding-bottom: 4px;
    margin-bottom: 20px;
  }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
  }
  input[type="number"], input[type="text"], select {
    width: 100%;
    padding: 8px 12px;
    font-size: 1rem;
    border: 1px solid #cbd5e1;
    border-radius: 6px;
    outline-offset: 2px;
    outline-color: #3b82f6;
    box-sizing: border-box;
  }
  button {
    background-color: #3b82f6;
    border: none;
    color: white;
    font-size: 1rem;
    font-weight: 700;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  button:hover {
    background-color: #2563eb;
  }
  button:disabled {
    background-color: #93c5fd;
    cursor: not-allowed;
  }
  .section {
    margin-bottom: 32px;
  }
  .flex-row {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }
  .flex-col {
    display: flex;
    flex-direction: column;
  }
  .flex-row > div, .flex-col > div {
    flex: 1;
    min-width: 250px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
  }
  th, td {
    border: 1px solid #e2e8f0;
    padding: 12px 16px;
    text-align: center;
  }
  th {
    background-color: #f1f5f9;
    position: sticky;
    top: 0;
    z-index: 2;
  }
  .table-wrapper {
    max-height: 360px;
    overflow-y: auto;
    border-radius: 10px;
    border: 1px solid #e2e8f0;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
  }
  .error-msg {
    color: #dc2626;
    font-weight: 700;
    margin-bottom: 20px;
  }
  .footer {
    background-color: #f1f5f9;
    text-align: center;
    padding: 12px 0;
    font-size: 14px;
    color: #64748b;
    user-select: none;
    margin-top: auto;
    border-top: 1px solid #cbd5e1;
  }
  .footer a {
    color: #3b82f6;
    text-decoration: none;
    margin: 0 12px;
  }
  .footer a:hover {
    text-decoration: underline;
  }
  @media (max-width: 640px) {
    .flex-row {
      flex-direction: column;
    }
    .flex-row > div {
      min-width: 100%;
    }
  }
</style>
</head>
<body>
  <div id="root"></div>
<footer class="footer">
  <a href="/privacy" target="_blank">éš±ç§æ¬Šæ”¿ç­–</a> |
  <a href="/terms" target="_blank">ä½¿ç”¨æ¢æ¬¾</a> |
  <a href="/about" target="_blank">é—œæ–¼æˆ‘å€‘</a> |
  <a href="/contact" target="_blank">è¯çµ¡æˆ‘å€‘</a>
</footer>

<script type="text/babel">

  const { useState, useEffect, useRef } = React;

  /**
   * é‚„æ¬¾äººè³‡æ–™çµæ§‹
   * @typedef {Object} RepayPerson
   * @property {string} name - å§“å
   * @property {number} debt - æ¬ æ¬¾é‡‘é¡
   */

  /**
   * èª²ç¨‹è³‡æ–™çµæ§‹
   * @typedef {Object} Course
   * @property {number} fee - èª²ç¨‹ç¸½è²»ç”¨
   * @property {number} months - èª²ç¨‹æœŸæ•¸(æœˆä»½)
   */

  /**
   * ä¸»å…ƒä»¶
   */
  function App() {

    // åŸºæœ¬è¼¸å…¥æ¬„ä½ç‹€æ…‹
    const [salary, setSalary] = useState('');
    const [livingExpense, setLivingExpense] = useState('');
    const [startMonth, setStartMonth] = useState(1);

    // é‚„æ¬¾äººåˆ—è¡¨ (RepayPerson[])
    const [repayList, setRepayList] = useState([]);
    // æ–°å¢é‚„æ¬¾äººæ¬„ä½
    const [newPersonName, setNewPersonName] = useState('');
    const [newPersonDebt, setNewPersonDebt] = useState('');

    // èª²ç¨‹åˆ—è¡¨ (Course[])
    const [courseList, setCourseList] = useState([]);
    // æ–°å¢èª²ç¨‹æ¬„ä½
    const [newCourseFee, setNewCourseFee] = useState('');
    const [newCourseMonths, setNewCourseMonths] = useState('');

    // éŒ¯èª¤è¨Šæ¯
    const [errorMsg, setErrorMsg] = useState('');

    // è¨ˆç®—çµæœç‹€æ…‹
    const [calcResult, setCalcResult] = useState(null);

    // Chart.js åœ–è¡¨å¯¦ä¾‹å¼•ç”¨
    const chartRef = useRef(null);
    const chartInstanceRef = useRef(null);

    // ====== è¼¸å…¥æ§åˆ¶èˆ‡é©—è­‰ ======
    // é©—è­‰æ•¸å­—æ ¼å¼ï¼Œå…è¨±ç©ºç™½æˆ–åˆæ³•æ­£æ•¸
    function validatePositiveNumber(val) {
      if (val === '') return true;
      return !isNaN(val) && Number(val) >= 0;
    }

    // ====== æ–°å¢é‚„æ¬¾äººåŠŸèƒ½ ======
    function addRepayPerson() {
      setErrorMsg('');
      if (!newPersonName.trim()) {
        setErrorMsg('è«‹è¼¸å…¥é‚„æ¬¾äººå§“å');
        return;
      }
      if (!newPersonDebt.trim() || isNaN(newPersonDebt) || Number(newPersonDebt) <= 0) {
        setErrorMsg('æ¬ æ¬¾é‡‘é¡å¿…é ˆæ˜¯å¤§æ–¼0çš„æ•¸å­—');
        return;
      }
      // æª¢æŸ¥å§“åæ˜¯å¦é‡è¤‡
      if (repayList.some(p => p.name === newPersonName.trim())) {
        setErrorMsg('é‚„æ¬¾äººå§“åä¸å¯é‡è¤‡');
        return;
      }
      setRepayList([...repayList, { name: newPersonName.trim(), debt: Number(newPersonDebt) }]);
      setNewPersonName('');
      setNewPersonDebt('');
    }

    // ====== æ–°å¢èª²ç¨‹åŠŸèƒ½ ======
    function addCourse() {
      setErrorMsg('');
      if (!newCourseFee.trim() || isNaN(newCourseFee) || Number(newCourseFee) <= 0) {
        setErrorMsg('èª²ç¨‹è²»ç”¨å¿…é ˆæ˜¯å¤§æ–¼0çš„æ•¸å­—');
        return;
      }
      if (!newCourseMonths.trim() || isNaN(newCourseMonths) || !Number.isInteger(Number(newCourseMonths)) || Number(newCourseMonths) <= 0) {
        setErrorMsg('èª²ç¨‹æœŸæ•¸å¿…é ˆæ˜¯å¤§æ–¼0çš„æ•´æ•¸');
        return;
      }
      setCourseList([...courseList, { fee: Number(newCourseFee), months: Number(newCourseMonths) }]);
      setNewCourseFee('');
      setNewCourseMonths('');
    }

    // ====== ç§»é™¤é‚„æ¬¾äºº ======
    function removeRepayPerson(index) {
      if (!window.confirm(`ç¢ºå®šè¦ç§»é™¤é‚„æ¬¾äºº ${repayList[index].name} å—ï¼Ÿ`)) return;
      const newList = [...repayList];
      newList.splice(index, 1);
      setRepayList(newList);
    }

    // ====== ç§»é™¤èª²ç¨‹ ======
    function removeCourse(index) {
      if (!window.confirm(`ç¢ºå®šè¦ç§»é™¤èª²ç¨‹ #${index + 1} å—ï¼Ÿ`)) return;
      const newList = [...courseList];
      newList.splice(index, 1);
      setCourseList(newList);
    }

    // ====== è¨ˆç®—é‚„æ¬¾è¨ˆç•« ======
    function calculateRepaymentPlan() {
      setErrorMsg('');
      setCalcResult(null);

      const sal = Number(salary);
      const expense = Number(livingExpense);
      const startMon = Number(startMonth);

      if (isNaN(sal) || sal <= 0) {
        setErrorMsg('è«‹è¼¸å…¥æ­£ç¢ºçš„æ¯æœˆè–ªæ°´ (å¤§æ–¼0)');
        return;
      }
      if (isNaN(expense) || expense < 0) {
        setErrorMsg('è«‹è¼¸å…¥æ­£ç¢ºçš„æ¯æœˆç”Ÿæ´»è²» (ä¸å¯ç‚ºè² æ•¸)');
        return;
      }
      if (!Number.isInteger(startMon) || startMon < 1 || startMon > 12) {
        setErrorMsg('èµ·å§‹æœˆä»½å¿…é ˆæ˜¯1~12çš„æ•´æ•¸');
        return;
      }
      if (repayList.length === 0) {
        setErrorMsg('è«‹è‡³å°‘æ–°å¢ä¸€ä½é‚„æ¬¾äºº');
        return;
      }
      if (courseList.length === 0) {
        setErrorMsg('è«‹è‡³å°‘æ–°å¢ä¸€é–€èª²ç¨‹');
        return;
      }

      // èª²ç¨‹æ¯æœˆè²»ç”¨åˆè¨ˆ
      const totalCourseMonthlyFee = courseList.reduce((sum, c) => sum + c.fee / c.months, 0);

      if (totalCourseMonthlyFee > sal - expense) {
        setErrorMsg('èª²ç¨‹æœˆè²»è¶…éè–ªæ°´æ‰£é™¤ç”Ÿæ´»è²»å¾Œçš„å¯ç”¨é¡åº¦');
        return;
      }

      // æ¯æœˆå¯ç”¨é‚„æ¬¾é¡åº¦
      const monthlyRepayBudget = sal - expense - totalCourseMonthlyFee;

      // æ¬ æ¬¾ç¸½é¡
      const totalDebt = repayList.reduce((sum, p) => sum + p.debt, 0);
      if (totalDebt <= 0) {
        setErrorMsg('æ¬ æ¬¾ç¸½é¡å¿…é ˆå¤§æ–¼0');
        return;
      }

      // è¤‡è£½å‰©é¤˜æ¬ æ¬¾
      let remainingDebts = repayList.map(p => ({ ...p }));
      let monthCount = 0;
      let plan = [];

      // æœ€å¤šè¨ˆç®—200æœŸï¼Œé¿å…æ­»å¾ªç’°
      while (remainingDebts.some(p => p.debt > 0) && monthCount < 200) {
        monthCount++;
        const monthNumber = ((startMon + monthCount - 2) % 12) + 1;
        let budget = monthlyRepayBudget;
        const monthPayment = {};

        // æ¬ æ¬¾ç¸½å’Œ
        const currentDebtSum = remainingDebts.reduce((sum, p) => sum + p.debt, 0);

        remainingDebts.forEach(p => {
          if (p.debt <= 0) {
            monthPayment[p.name] = 0;
            return;
          }
          const ratio = p.debt / currentDebtSum;
          let payAmount = Math.min(Math.round(monthlyRepayBudget * ratio * 100) / 100, p.debt, budget);
          budget -= payAmount;
          p.debt = Math.round((p.debt - payAmount) * 100) / 100;
          monthPayment[p.name] = payAmount;
        });

        // å°‡å‰©é¤˜é ç®—å¹³å‡åˆ†é…çµ¦å°šæœªé‚„æ¸…çš„é‚„æ¬¾äºº
        if (budget > 0) {
          const debtors = remainingDebts.filter(p => p.debt > 0);
          if (debtors.length > 0) {
            const extraPerPerson = Math.round((budget / debtors.length) * 100) / 100;
            debtors.forEach(p => {
              const extraPay = Math.min(extraPerPerson, p.debt);
              p.debt = Math.round((p.debt - extraPay) * 100) / 100;
              monthPayment[p.name] += extraPay;
            });
          }
        }

        plan.push({ month: monthNumber, pays: { ...monthPayment } });
      }

      setCalcResult({
        totalDebt,
        monthlyRepayBudget,
        totalCourseMonthlyFee,
        totalMonths: monthCount,
        plan,
      });
    }

    // ====== è¤‡è£½çµæœæ–‡å­— ======
    function copyResultToClipboard() {
      if (!calcResult) {
        alert('è«‹å…ˆè¨ˆç®—é‚„æ¬¾è¨ˆç•«');
        return;
      }
      let text = `æ¯æœˆå¯ç”¨é‚„æ¬¾é¡åº¦ï¼š${calcResult.monthlyRepayBudget.toFixed(2)} å…ƒ\n`;
      text += `ç¸½æ¬ æ¬¾é‡‘é¡ï¼š${calcResult.totalDebt.toFixed(2)} å…ƒ\n`;
      text += `èª²ç¨‹æ¯æœˆè²»ç”¨ï¼š${calcResult.totalCourseMonthlyFee.toFixed(2)} å…ƒ\n`;
      text += `ä¼°è¨ˆé‚„æ¬¾æœŸæ•¸ï¼šç´„ ${calcResult.totalMonths} å€‹æœˆ\n\n`;
      text += `è©³ç´°æ¯æœˆé‚„æ¬¾è¨ˆç•«ï¼š\n`;

      calcResult.plan.forEach((m, idx) => {
        text += `ç¬¬${idx + 1}å€‹æœˆ (æœˆä»½: ${m.month}æœˆ):\n`;
        Object.entries(m.pays).forEach(([name, pay]) => {
          text += `  ${name}: ${pay.toFixed(2)} å…ƒ\n`;
        });
        text += '\n';
      });

      navigator.clipboard.writeText(text).then(() => alert('å·²è¤‡è£½çµæœåˆ°å‰ªè²¼ç°¿'));
    }

    // ====== åŒ¯å‡º CSV ======
    function exportCsvFile() {
      if (!calcResult) {
        alert('è«‹å…ˆè¨ˆç®—é‚„æ¬¾è¨ˆç•«');
        return;
      }
      let csv = 'æœˆä»½,é‚„æ¬¾äºº,é‚„æ¬¾é‡‘é¡\n';
      calcResult.plan.forEach(m => {
        Object.entries(m.pays).forEach(([name, pay]) => {
          csv += `${m.month},${name},${pay.toFixed(2)}\n`;
        });
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `repayment_plan_${new Date().toISOString().slice(0,10)}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // ====== Chart.js é¡¯ç¤ºæ¬ æ¬¾åˆ†å¸ƒ ======
    useEffect(() => {
      if (chartInstanceRef.current) {
        chartInstanceRef.current.destroy();
      }
      if (repayList.length === 0) return;

      const ctx = chartRef.current.getContext('2d');
      chartInstanceRef.current = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: repayList.map(p => p.name),
          datasets: [{
            label: 'æ¬ æ¬¾é‡‘é¡',
            data: repayList.map(p => p.debt),
            backgroundColor: [
              '#3b82f6', '#10b981', '#ef4444', '#f59e0b', '#8b5cf6',
              '#06b6d4', '#db2777', '#6d28d9', '#ca8a04', '#4ade80'
            ],
            borderWidth: 1,
          }],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'right',
              labels: { font: { size: 14 } }
            },
            tooltip: { enabled: true },
            title: {
              display: true,
              text: 'é‚„æ¬¾äººæ¬ æ¬¾æ¯”ä¾‹åœ–',
              font: { size: 18, weight: 'bold' }
            },
          },
          cutout: '60%',
        },
      });
    }, [repayList]);

    // ====== ä¸»ç•«é¢æ¸²æŸ“ ======
    return (
      <main role="main" aria-label="è¶…ç´šé‚„æ¬¾è©¦ç®—è¡¨ä¸»ç•«é¢">
        <h1>ğŸ’° è¶…ç´šé‚„æ¬¾è©¦ç®—è¡¨</h1>

        {/* è–ªè³‡èˆ‡ç”Ÿæ´»è²»è¼¸å…¥ */}
        <section className="section" aria-labelledby="salary-expense-label">
          <h2 id="salary-expense-label">åŸºæœ¬è³‡æ–™è¼¸å…¥</h2>
          <div className="flex-row">
            <div className="flex-col">
              <label htmlFor="salary">æ¯æœˆè–ªæ°´ (å…ƒ)</label>
              <input
                type="number"
                id="salary"
                min="0"
                step="100"
                placeholder="è¼¸å…¥æ¯æœˆè–ªæ°´"
                value={salary}
                onChange={e => validatePositiveNumber(e.target.value) && setSalary(e.target.value)}
                aria-required="true"
              />
            </div>
            <div className="flex-col">
              <label htmlFor="living-expense">æ¯æœˆç”Ÿæ´»è²» (å…ƒ)</label>
              <input
                type="number"
                id="living-expense"
                min="0"
                step="100"
                placeholder="è¼¸å…¥æ¯æœˆç”Ÿæ´»è²»"
                value={livingExpense}
                onChange={e => validatePositiveNumber(e.target.value) && setLivingExpense(e.target.value)}
                aria-required="true"
              />
            </div>
            <div className="flex-col" style={{minWidth: '120px'}}>
              <label htmlFor="start-month">èµ·å§‹æœˆä»½</label>
              <select
                id="start-month"
                value={startMonth}
                onChange={e => setStartMonth(Number(e.target.value))}
                aria-required="true"
              >
                {[...Array(12).keys()].map(m => (
                  <option key={m+1} value={m+1}>{m+1} æœˆ</option>
                ))}
              </select>
            </div>
          </div>
        </section>

        {/* é‚„æ¬¾äººæ–°å¢èˆ‡åˆ—è¡¨ */}
        <section className="section" aria-labelledby="repay-list-label">
          <h2 id="repay-list-label">æ–°å¢é‚„æ¬¾äºº</h2>
          <div className="flex-row" style={{alignItems: 'flex-end'}}>
            <div className="flex-col">
              <label htmlFor="new-person-name">å§“å</label>
              <input
                type="text"
                id="new-person-name"
                placeholder="è¼¸å…¥é‚„æ¬¾äººå§“å"
                value={newPersonName}
                onChange={e => setNewPersonName(e.target.value)}
                aria-required="true"
                maxLength={20}
              />
            </div>
            <div className="flex-col">
              <label htmlFor="new-person-debt">æ¬ æ¬¾é‡‘é¡ (å…ƒ)</label>
              <input
                type="number"
                id="new-person-debt"
                min="0"
                step="100"
                placeholder="è¼¸å…¥æ¬ æ¬¾é‡‘é¡"
                value={newPersonDebt}
                onChange={e => validatePositiveNumber(e.target.value) && setNewPersonDebt(e.target.value)}
                aria-required="true"
              />
            </div>
            <div>
              <button onClick={addRepayPerson} aria-label="æ–°å¢é‚„æ¬¾äºº">æ–°å¢</button>
            </div>
          </div>

          {/* é‚„æ¬¾äººåˆ—è¡¨è¡¨æ ¼ */}
          {repayList.length === 0 ? (
            <p style={{marginTop:'12px'}}>å°šç„¡é‚„æ¬¾äººè³‡æ–™</p>
          ) : (
            <div className="table-wrapper" role="table" aria-label="é‚„æ¬¾äººåˆ—è¡¨" style={{marginTop:'12px'}}>
              <table>
                <thead>
                  <tr>
                    <th>å§“å</th>
                    <th>æ¬ æ¬¾é‡‘é¡ (å…ƒ)</th>
                    <th>æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody>
                  {repayList.map((p, i) => (
                    <tr key={i}>
                      <td>{p.name}</td>
                      <td>{p.debt.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                      <td>
                        <button
                          onClick={() => removeRepayPerson(i)}
                          aria-label={`ç§»é™¤é‚„æ¬¾äºº ${p.name}`}
                          style={{backgroundColor:'#ef4444', margin: '0 auto', display:'block'}}
                        >åˆªé™¤</button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </section>

        {/* èª²ç¨‹æ–°å¢èˆ‡åˆ—è¡¨ */}
        <section className="section" aria-labelledby="course-list-label">
          <h2 id="course-list-label">æ–°å¢èª²ç¨‹</h2>
          <div className="flex-row" style={{alignItems: 'flex-end'}}>
            <div className="flex-col">
              <label htmlFor="new-course-fee">èª²ç¨‹ç¸½è²»ç”¨ (å…ƒ)</label>
              <input
                type="number"
                id="new-course-fee"
                min="0"
                step="100"
                placeholder="è¼¸å…¥èª²ç¨‹è²»ç”¨"
                value={newCourseFee}
                onChange={e => validatePositiveNumber(e.target.value) && setNewCourseFee(e.target.value)}
                aria-required="true"
              />
            </div>
            <div className="flex-col" style={{minWidth:'140px'}}>
              <label htmlFor="new-course-months">èª²ç¨‹æœŸæ•¸ (æœˆ)</label>
              <input
                type="number"
                id="new-course-months"
                min="1"
                max="100"
                step="1"
                placeholder="è¼¸å…¥èª²ç¨‹æœŸæ•¸"
                value={newCourseMonths}
                onChange={e => {
                  const val = e.target.value;
                  if (val === '' || (/^\d+$/.test(val) && Number(val) > 0 && Number(val) <= 100)) {
                    setNewCourseMonths(val);
                  }
                }}
                aria-required="true"
              />
            </div>
            <div>
              <button onClick={addCourse} aria-label="æ–°å¢èª²ç¨‹">æ–°å¢</button>
            </div>
          </div>

          {/* èª²ç¨‹åˆ—è¡¨è¡¨æ ¼ */}
          {courseList.length === 0 ? (
            <p style={{marginTop:'12px'}}>å°šç„¡èª²ç¨‹è³‡æ–™</p>
          ) : (
            <div className="table-wrapper" role="table" aria-label="èª²ç¨‹åˆ—è¡¨" style={{marginTop:'12px'}}>
              <table>
                <thead>
                  <tr>
                    <th>èª²ç¨‹ç·¨è™Ÿ</th>
                    <th>èª²ç¨‹ç¸½è²»ç”¨ (å…ƒ)</th>
                    <th>èª²ç¨‹æœŸæ•¸ (æœˆ)</th>
                    <th>æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody>
                  {courseList.map((c, i) => (
                    <tr key={i}>
                      <td>{i+1}</td>
                      <td>{c.fee.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                      <td>{c.months}</td>
                      <td>
                        <button
                          onClick={() => removeCourse(i)}
                          aria-label={`ç§»é™¤èª²ç¨‹ç·¨è™Ÿ ${i+1}`}
                          style={{backgroundColor:'#ef4444', margin: '0 auto', display:'block'}}
                        >åˆªé™¤</button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </section>

        {/* éŒ¯èª¤è¨Šæ¯ */}
        {errorMsg && <p className="error-msg" role="alert">{errorMsg}</p>}

        {/* è¨ˆç®—æŒ‰éˆ• */}
        <div style={{textAlign: 'center', marginBottom: '32px'}}>
          <button
            onClick={calculateRepaymentPlan}
            aria-label="é–‹å§‹è¨ˆç®—é‚„æ¬¾è¨ˆç•«"
            style={{minWidth:'260px', fontWeight:'700', fontSize:'1.3rem'}}
          >
            è¨ˆç®—é‚„æ¬¾è¨ˆç•«
          </button>
        </div>

        {/* è¨ˆç®—çµæœ */}
        {calcResult && (
          <section className="section" aria-labelledby="result-label">
            <h2 id="result-label">è©¦ç®—çµæœ</h2>
            <p>æ¯æœˆå¯ç”¨é‚„æ¬¾é¡åº¦ï¼š<strong>{calcResult.monthlyRepayBudget.toFixed(2)}</strong> å…ƒ</p>
            <p>ç¸½æ¬ æ¬¾é‡‘é¡ï¼š<strong>{calcResult.totalDebt.toFixed(2)}</strong> å…ƒ</p>
            <p>èª²ç¨‹æ¯æœˆè²»ç”¨åˆè¨ˆï¼š<strong>{calcResult.totalCourseMonthlyFee.toFixed(2)}</strong> å…ƒ</p>
            <p>ä¼°è¨ˆé‚„æ¬¾æœŸæ•¸ï¼šç´„ <strong>{calcResult.totalMonths}</strong> å€‹æœˆ</p>

            <div
              className="chart-container"
              role="img"
              aria-label="æ¬ æ¬¾æ¯”ä¾‹åœ“é¤…åœ–"
              style={{maxWidth:'480px', margin:'20px auto'}}
            >
              <canvas ref={chartRef} width="480" height="360"></canvas>
            </div>

            {/* æ¯æœˆé‚„æ¬¾æ˜ç´°è¡¨æ ¼ */}
            <div className="table-wrapper" style={{maxHeight:'480px'}}>
              <table aria-label="æ¯æœˆé‚„æ¬¾è¨ˆç•«æ˜ç´°" style={{tableLayout:'fixed'}}>
                <thead>
                  <tr>
                    <th style={{width:'80px'}}>æœˆä»½</th>
                    {repayList.map(p => (
                      <th key={p.name} style={{wordBreak:'break-word'}}>{p.name}</th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {calcResult.plan.map((m, idx) => (
                    <tr key={idx}>
                      <td>{m.month} æœˆ</td>
                      {repayList.map(p => (
                        <td key={p.name}>{(m.pays[p.name] || 0).toFixed(2)}</td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {/* è¤‡è£½èˆ‡åŒ¯å‡ºæŒ‰éˆ• */}
            <div style={{marginTop:'24px', textAlign:'center'}}>
              <button onClick={copyResultToClipboard} aria-label="è¤‡è£½é‚„æ¬¾çµæœ">è¤‡è£½çµæœ</button>
              <button onClick={exportCsvFile} aria-label="åŒ¯å‡ºé‚„æ¬¾è¨ˆç•« CSV" style={{marginLeft:'16px'}}>åŒ¯å‡º CSV</button>
            </div>
          </section>
        )}

      </main>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App />);

</script>
</body>
</html>
